<link rel="import" href="../../bower_components/polymer/polymer.html"/>
<link rel="import" href="../../bower_components/core-animated-pages/core-animated-pages.html"/>
<link rel="import" href="../../bower_components/core-toolbar/core-toolbar.html"/>
<link rel="import" href="../../bower_components/core-header-panel/core-header-panel.html"/>
<link rel="import" href="../../bower_components/paper-button/paper-button.html"/>
<link rel="import" href="../../bower_components/core-drawer-panel/core-drawer-panel.html"/>
<link rel="import" href="../../bower_components/core-scroll-header-panel/core-scroll-header-panel.html"/>
<link rel="import" href="../../components/new-tournament/new-tournament.html">
<link rel="import" href="../../components/person-listing/person-listing.html?123">
<link rel="import" href="../../components/player-listing/player-listing.html">
<link rel="import" href="../../components/current-matches/current-matches.html">
<link rel="import" href="../../components/tournament-listing/tournament-listing.html">
<link rel="import" href="../../components/new-player/new-player.html">


<polymer-element name="monrad-main" vertical layout>
    <template>
        <core-drawer-panel id="drawerPanel" drawerWidth="300px">
            <core-header-panel drawer style="background-color: #f2f7fa">
                <core-toolbar>
                    <span flex>BEKK Chess</span>
                </core-toolbar>
                <section>
                    <player-listing
                            id="small_players"
                            tournamentId="{{tournamentId}}"
                            tournamentName="{{tournamentName}}"
                            cross-fade
                            selectedSection="{{selected}}"/>
                </section>
            </core-header-panel>
            <core-header-panel main>
                <core-toolbar>
                    <span flex></span>
                    <template if="{{tournamentId}}">
                        <paper-button id="b2" on-tap="{{players_selected}}">Players</paper-button>
                        <paper-button id="b3" on-tap="{{matches_selected}}">Matches</paper-button>
                    </template>
                    <paper-button id="b4" on-tap="{{tournaments_selected}}">Tournaments</paper-button>
                    <paper-button id="b1" on-tap="{{persons_selected}}">Persons</paper-button>
                </core-toolbar>
                <core-animated-pages selected="{{selected}}" flex auto
                                     transitions="slide-up slide-down cross-fade">
                    <section name="players">
                        <h2>{{tournamentName}}'s players</h2>
                        <player-listing id="players" tournamentId="{{tournamentId}}"
                                        tournamentName="{{tournamentName}}"
                                        large="true" cross-fade selectedSection="{{selected}}"></player-listing>
                        <new-player tournamentId="{{tournamentId}}"/>
                    </section>
                    <section name="matches">
                        <current-matches id="matches" tournamentId="{{tournamentId}}"
                                         tournamentName="{{tournamentName}}"
                                         cross-fade selectedSection="{{selected}}"
                                         on-tournament-finished="{{tournamentFinished}}"></current-matches>
                    </section>
                    <section name="tournaments">
                        <tournament-listing id="tournaments" on-tournament_changed="{{tournament_changed}}"
                                            cross-fade selectedSection="{{selected}}"></tournament-listing>
                    </section>
                    <section name="persons">
                        <person-listing id="persons" cross-fade selectedSection="{{selected}}"></person-listing>
                    </section>
                </core-animated-pages>
            </core-header-panel>
        </core-drawer-panel>
    </template>
    <script>
        Polymer("monrad-main", {
            ready: function () {
                if (window.location.hash) {
                    this.tournamentId = window.location.hash.substring(1).split("!")[0];
                    this.tournamentName = decodeURI(window.location.hash.substring(1).split("!")[1]);
                    this.selected = "players";
                    this.players_selected();
                } else {
                    this.selected = "tournaments";
                }
            },
            players_selected: function () {
                this.selected = "players";
                this.$.players.updatePlayers();
                this.$.small_players.updatePlayers();
            },
            matches_selected: function () {
                this.selected = "matches";
                this.$.matches.update();
            },
            tournaments_selected: function () {
                this.selected = "tournaments";
            },
            persons_selected: function () {
                this.selected = "persons";
            },
            tournament_changed: function (event, arguments) {
                this.tournamentId = arguments.id;
                this.tournamentName = arguments.name;
                this.players_selected();
                window.location.hash = this.tournamentId + "!" + encodeURI(this.tournamentName);
            },
            tournamentFinished: function () {
                this.$.persons.update();
            }
        });

    </script>

</polymer-element>